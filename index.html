<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

</head>

<body>

    <!-- Display the countdown timer in an element -->
<p id="demo"></p>

<script>

//---------------- Global Variables (Sorry!!) --------------------
var importantVariables = {
    mainEndDate: ""
}

//TODO: Set the cookies with this sucker, and then reference it on revisit. 
// ------------- Tooling out the Cookie Functions ----------------


function getCookie(cname) {
    var name = cname + "=";
    var decodeCookie = decodeURIComponent(document.cookie);
    console.log(decodeCookie);
    var cookieArray = decodeCookie.split(';');
    for(var i = 0; i < cookieArray.length; i++) {
        var c = cookieArray[i];
        while (c.charAt(0) == ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
        }
    }
}

function setCookie(cname, cvalue, exdays) {
    var d = new Date();
    d.setTime(d.getTime() + (exdays*24*60*60*1000));
    var expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function checkCookie() {
    var endDate = getCookie("endDate");
    if(endDate != "" && endDate != undefined) {
        importantVariables.mainEndDate = endDate;
        //TODO: Show the countdown timer

        console.log("Cookie Exists");
        console.log(endDate);
    } else {
        var timerLengthInDays = 2;
        var setEndDate = new Date();
        setEndDate.setTime(setEndDate.getTime() + (timerLengthInDays*24*60*60*1000));
        setCookie("endDate", setEndDate, 365);

        importantVariables.mainEndDate = setEndDate;
        console.log("Cookie Set");
        console.log(setEndDate);
    }
}

checkCookie();

// Set the date we're counting down to
var countDownDate = new Date(importantVariables.mainEndDate);


// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = new Date().getTime();

  // Find the distance between now and the count down date
  var distance = countDownDate.getTime() - now;

  // Time calculations for days, hours, minutes and seconds
  var hours = Math.floor((distance/ (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // Display the result in the element with id="demo"
  // TODO: Split this into divs and make it look all pretty.
  document.getElementById("demo").innerHTML =  hours + "h "
  + minutes + "m " + seconds + "s ";

  // If the count down is finished, write some text
  if (distance < 0) {
    clearInterval(x);
    document.getElementById("demo").innerHTML = "EXPIRED";
  }
}, 1000);
</script>

</body>

</html>